<link rel="import" href="../../bower_components/polymer/polymer.html">
<link rel="import" href="../services/word-service.html">

<dom-module id="word-board">
  <style>
  </style>
  <template>
    <div class="word-board"><span>{{myWord}}</span></div>
    <audio src="{{wordAudio}}" hidden></audio>
    <word-service id="wservice" currlang="{{langCode}}" warray="{{warray}}"></word-service>
  </template>
</dom-module>
<script>
(function() {

  Polymer({
    is: "word-board",
    properties: {
      langCode: {
        type: String,
        notify: true
      },
      wordAudio: {
        type: String
      },
      myWord: {
        type: String,
        value: "",
        notify: true
      },
      wordArray: {
        type: Array,
        notify: true,
        value: function() { return []; }
      },
      ranWordIndex: {
        type: Number
      }
    },
    listeners: {
      'new-words': 'setWords',
      'lang-code-changed': 'changeLanguage',
      'word-array-changed': 'wordFilter',
      'tap': 'playAudio'
    },
    created: function() {
    },
    ready: function() {
      this.jumbotronBox = document.querySelector("jumbotron-text");
      this.scoreBox = document.getElementById('score-board-player-1');
      this.letterListBox = document.querySelector('letter-list');
      
      this.audioBox = Polymer.dom(this.root).querySelector("audio");
    },
    changeLanguage: function(event) {
      this.$.wservice.currlang = this.langCode;
    },
    wordFilter: function() {
      var randomIndex = Math.floor(Math.random() * this.wordArray.length);
      if(this.wordArray.length !== 0) {
        if(this.ranWordIndex !== undefined) {
          for(var i=0;this.ranWordIndex === randomIndex;i++) {
            randomIndex = Math.floor(Math.random() * this.wordArray.length);
            if(i > 20) break;
          }
        }
        this.ranWordIndex = randomIndex;
        console.log("wordArray.length: " + this.wordArray.length + "\nthis.ranWordIndex: " + this.ranWordIndex);
        var word = this.wordArray[this.ranWordIndex];
        //this.fire("random-word-selected", { value: word[0], valueOhneAccent: word[1], langCode: this.langCode });
        this.myWord = word[0];
        this.wordAudio = this.produceWordAudioUrl(word[0], this.langCode);
        //letterListBox.onNewWord2([word[0], word[1]]);
        this.letterListBox.filterWord = word;
        this.scoreBox.checkWord = [word[0], word[1]];
        
        this.jumbotronBox.zielWort = word[0];
      }

    },
    setWords: function() {
      var items = this.$.wservice.warray;
      if(items.length !== 0) {
        this.wordArray = items;
      }
      return items;
    },
    revealWord: function() {
      var word = this.wordArray[this.ranWordIndex][1];
      word.split("").forEach(function(value, index) {
        setTimeout(function() {
          var lCard = document.querySelector('letter-card[letter="'+value+'"]');
          lCard.firePaperRipple();
        }, 1500 * (index + 0.5));
      });
    },
    produceWordAudioUrl: function(word, lang) {
      return "/assets/audio/"+ lang +"/words/" + word.toLowerCase() + ".m4a";
    },
    playAudio: function() {
      this.audioBox.play();
    }
  });
})();
</script>