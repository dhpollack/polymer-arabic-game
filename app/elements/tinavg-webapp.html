<link rel="import" href="../../bower_components/polymer/polymer.html">
<!-- Additional Component Load -->
<!-- Layout/Polymer Elements -->
<link rel="import" href="../../bower_components/paper-tabs/paper-tabs.html">
<link rel="import" href="../../bower_components/iron-flex-layout/iron-flex-layout.html">
<link rel="import" href="../../bower_components/paper-styles/paper-styles.html">
<link rel="import" href="../../bower_components/paper-header-panel/paper-header-panel.html">
<link rel="import" href="../../bower_components/paper-drawer-panel/paper-drawer-panel.html">
<link rel="import" href="../../bower_components/iron-pages/iron-pages.html">
<link rel="import" href="../../bower_components/paper-toggle-button/paper-toggle-button.html">
<link rel="import" href="../../bower_components/paper-toast/paper-toast.html">
<link rel="import" href="../../bower_components/paper-dialog/paper-dialog.html">
<link rel="import" href="../../bower_components/paper-button/paper-button.html">
<link rel="import" href="../../bower_components/paper-input/paper-input.html">
<link rel="import" href="../../bower_components/paper-input/paper-textarea.html">
<link rel="import" href="../../bower_components/neon-animation/neon-animations.html">
<link rel="import" href="../../bower_components/iron-localstorage/iron-localstorage.html">
<link rel="import" href="../../bower_components/firebase-element/firebase.html">
<link rel="import" href="../../bower_components/firebase-element/firebase-auth.html">
<!-- Custom Elements -->
<link rel="import" href="tinavg-behavior.html">
<link rel="import" href="elements.html">
<!-- keyboard shortcuts -->
<script src="../assets/js/mousetrap.min.js"></script>
<dom-module id="tinavg-webapp">
  <style is="custom-style">
    /* see tinavg-style.html */
  </style>
  <template>
    
    <!-- localstorage -->
    <iron-localstorage name="tinavg-lastlang" value="{{gameLang}}"></iron-localstorage>
    <iron-localstorage name="tinavg-earmodus" value="{{earmodus}}"></iron-localstorage>
    <iron-localstorage name="tinavg-learnmodus" value="{{learnmodus}}"></iron-localstorage>
    <iron-localstorage name="tinavg-recordmodus" value="{{recordmodus}}"></iron-localstorage>
    <iron-localstorage name="tinavg-nerdmodus" value="{{nerdmodus}}"></iron-localstorage>
    <iron-localstorage name="tinavg-nerdsprache" value="{{nerdSprache}}"></iron-localstorage>

    <!-- in main viewport -->
    <paper-drawer-panel id="pdp" responsive-width="25000px" right-drawer>
      
      <!-- Drawer -->
      <div id="collapse" class="mini-menu" drawer>
        <div>
          Language: 
          <select id="selectLang" on-change="setLang">
            <template is="dom-repeat" items="{{languageList}}"><option value="{{item.abbrev}}">{{item.fullname}}</option></template>
          </select>
        </div>
        <br /><div>Earmodus: <paper-toggle-button id="select_earmodus" on-tap="toggleEarModus" checked$="{{earmodus}}"></paper-toggle-button></div>
        <br /><div>Learnmodus: <paper-toggle-button id="select_learnmodus" on-tap="toggleLearnModus" checked$="{{learnmodus}}"></paper-toggle-button></div>
        <br /><div>Meiselmodus: <paper-toggle-button id="select_nerdmodus" on-tap="toggleNerdModus" checked$="{{nerdmodus}}"></paper-toggle-button></div>
        <br /><div>
          Meiselsprache: 
          <select id="meiselspracheliste" on-change="setNerdSprache">
            <template is="dom-repeat" items="{{nerdSpracheList}}"><option value="{{item.abbrev}}">{{item.fullname}}</option></template>
          </select>
        </div>
        <br /><div>Talkmodus: <paper-toggle-button id="select_recordmodus" on-tap="toggleRecordModus" checked$="{{recordmodus}}"></paper-toggle-button></div>
        <br /><div>
          <firebase-auth id="firebaseLogin" user="{{user}}" status-known="{{statusKnown}}" location="https://intense-heat-8981.firebaseio.com" provider="twitter" on-error="errorHandler" ></firebase-auth>
          <img src="../assets/images/sign-in-with-twitter-gray.png" alt="sign in with Twitter" on-tap="login" hidden$="{{computeLoginHidden(statusKnown, user)}}">
          <button on-tap="logout" hidden$="{{!computeLoginHidden(statusKnown, user)}}">Logout</button>
        </div>
      </div>
      
      <!-- Main Content Area -->
      <paper-header-panel id="header-panel" main>
        <div class="two-headers paper-header">
          <div class="footer horizontal justified layout center">
            <div class="footer-button horizontal start-justified layout flex">
              <score-board id="score-board-player-1" player="1" learnmodus="{{learnmodus}}" recordmodus="{{recordmodus}}"></score-board>
            </div>
            <word-board id="wboard" class="horizontal center-justified layout flex-2" game-lang="{{gameLang}}" earmodus="{{earmodus}}"></word-board>
            <div class="horizontal end-justified layout flex">
              <iron-icon id="menutoggle" class="spin-flip-transition tinavg-med-icon big" icon="menu" paper-drawer-toggle></iron-icon>
            </div>
          </div>
          <div class="core-header horizontal justified layout center">
            <div class="top-right-item horizontal start-justified layout flex">
              <iron-icon id="help-show" class="tinavg-med-icon" icon="help" on-tap="showHelp"></iron-icon>
              <lang-flag id="switchModusIcon" game-lang="[[gameLang]]" langs="[[languageList]]" on-tap="switchModus"></lang-flag>
            </div>
            <div class="horizontal center-justified layout flex-2">
              <jumbotron-text id="jt" tabindex="{{jumbotronIndexCompute()}}" learnmodus="{{learnmodus}}"></jumbotron-text>
            </div>
            <div id="nerdmodus-div" class="horizontal end-justified layout flex">
              <score-board id="score-board-player-2" player="2" hidden></score-board>
              <div id="clue-show-div" class="tinavg-med-icon"><iron-icon id="clueshow" class="spin-flip-transition tinavg-med-icon" icon="text-format" on-tap="showClue"></iron-icon></div>
            </div>
          </div>
        </div>
        <div id="maincontentarea" class="content">
          <word-recorder id="wrecorder" hidden$="{{!recordmodus}}"></word-recorder>
          <letter-list id="lettergrid" limit="{{letterLimit}}" game-lang="{{gameLang}}" hidden$="{{recordmodus}}"></letter-list>
        </div>
        <paper-toast id="übersetzung" text="{{gameLang}}"></paper-toast>
      </paper-header-panel>
    </paper-drawer-panel>
    <!-- Dialog Modal -->
    <paper-dialog id="so" entry-animation="slide-from-left-animation" exit-animation="slide-right-animation" with-backdrop>
      <div id="overlay-toolbar" class="vertical flex overlay-toolbar">
        <center><h2>This Is Not A Vocabulary Game</h2></center>
        <paper-tabs selected="{{selected}}">
          <paper-tab>Rules</paper-tab>
          <paper-tab>Credits</paper-tab>
          <paper-tab>Contact</paper-tab>
        </paper-tabs>
      </div>
      <iron-pages selected="{{selected}}" class="overlay-pages">
        <div id="rules">
          <h3>The Goal</h3>
          <p>Learn the alphabet (shapes and sounds) and spelling patterns of a foreign language.</p>
          <h3>The Rules: Normal / Earmodus / Learnmodus / Talkmodus</h3>
          <ol>
            <li>Look at the word at the top of the page.</li>
            <li>Spell the word by tapping the letters in the grid.</li>
            <li>Check your answer by tapping the word just below the target word.</li>
            <li>100 points for a correct answer and -30 for an incorrect answer.</li>
            <li>Earmodus: The word is hidden and only spoken.  The underline gives hints about the word's grammar.</li>
            <li>Learnmodus: Skip words and do not lose 30 pts for incorrect answers.</li>
            <li>Talkmodus: Record your voice and play it.  Then click the emoticon for the next word and 250 pts.</li>
          </ol>
          <h3>The Buttons</h3>
          <ol>
            <li><div class="tinavg-med-icon"><iron-icon id="help-overlay-menutoggle" icon="menu" class="tinavg-med-icon"></iron-icon></div>: Reveals the options menu</li>
            <li><div class="tinavg-med-icon"><iron-icon id="help-overlay-a" icon="text-format" class="tinavg-med-icon"></iron-icon></div>: Goes through the letter sequence, then says the word aloud</li>
            <li><div class="tinavg-med-icon"><iron-icon id="help-overlay-help-show" icon="help" class="tinavg-med-icon"></iron-icon></div>: Shows this help menu.</li>
            <li><div class="tinavg-med-icon"><lang-flag id="help-overlay-switch-modus" mylang="[[gameLang]]" langs="[[languageList]]" class="same-line"></lang-flag></div>: Switches the language.  Does NOT check word.</li>
            <li><div class="tinavg-med-icon"><iron-icon icon="av:mic" class="tinavg-med-icon"></iron-icon></div>: Record voice in Talkmodus.  Also stops recording.</li>
            <li><div class="tinavg-med-icon"><iron-icon icon="av:play-circle-filled" class="tinavg-med-icon"></iron-icon></div>: Play voice recording.  Also stops recording.</li>
            <li>Target Word: You can click this to have the word spoken outloud.</li>
          </ol>
          <div id="llin" hidden><small>You last logged in on: <span>{{lastvisit}}</span></small></div>
          <div id="help-lang-specific"></div>
        </div>
        <div id="credits">
          <p>First, I know that I won't be able to thank everyone that made this game possible, but I wanted to give credit to a few people that have inspired me to develop this game and to those that have lent their voice to the game.</p>
          <h3>German</h3>
            <strong>Voice: Ina Schoof</strong>
              <ul>
                <li>Ina has not only has she provided a voice that shatters all the preconceived notions that German is an "ugly" sounding language, but she has also been super supportive as a flatmate, a friend, and even as a fake girlfriend with the Ausländerbehörde.</li>
              </ul>
          <h3>English (US and Southern US)</h3>
            <strong>Voice: David Pollack</strong><br>
            <strong>Inspiration (Southern US): Pete Delaune</strong>
              <ul>
                <li>In a previous life, Pete was my partner in crime in the Atlanta low-society social scene.  We would practice our southern accents with each other to the point where we could hold entire conversations in the dialect only pausing from time to time to laugh at how ridiculous we sounded.  But like Icarus one cannot fly too close to the sun forever. Thus we can blame Pete for driving me away from the States and onto my language learning sojourn in Deutschland.  Danke Pete, ich haße dich wirklich mit allem Kraft auf der Welt... hehe, just kidding.</li>
              </ul>
          <h3>Arabic</h3>
            <strong>Voice (alphabet): Tamam El-Mohamed</strong>
              <ul>
                <li>Tamam is one of my students at the Rütli Schule and the voice of the Arabic alphabet.  I really appreciated her and all my other students enthusiasm at the Rütli Schule.  They've given me a much deeper perspective on what it is like growing up in Berlin.</li>
              </ul>
          <h3>Korean and Russian</h3>
            <strong>Voice (words): <a href="http://updates.html5rocks.com/2014/01/Web-apps-that-talk---Introduction-to-the-Speech-Synthesis-API" target="_blank">Speech Synthesis API</a></strong><br>
            <strong>Voice (letters): <a href="https://goo.gl/photos/g1djbMV34RKZX78FA" target="_blank">die Schreibmaschine</strong></a>
              <ul>
                <li>Of course, I'd like to thank die Schreibmaschine for providing her voice for the letters that have yet to be vocalized.  :-)</li>
              </ul>
          <h3>Hebrew</h3>
            <strong>Voice: Suzan Badran</strong>
              <ul>
                <li>Suzan hails from Israel and contributed her voice after a chance meeting while she was on vacation in Berlin.  I was super excited about that because I was going to Israel the very next week, so I could actually put this project to use.  She also showed me a around a bit in Jerusalem and will hopefully remain a dear friend in the future.</li>
              </ul>
          <p>Additionally, I would like to thank my friend, Luisa Meisel, for whom the "Meiselmodus" is named after (originally conceived as "Nerdmodus").  She was the first of many that suggested that I add definitions to the game.  I resisted for a long time, even going so far as to name the game "this is not a vocabulary game" but in the end, I conceded.</p>
          <p>Finally, I would like to thank my father, Bob Pollack.  The list would be endless if I had to thank him for everything, but he has endured the trials and tribulations of beta testing tinavg.com on the iPad/iPhone.  His along with all of my friends' comments, suggestions, criticisms, and wild looks of bewilderment have made this game what it is today.</p>
        </div>
        <div id="contact">
          <h3>Email Me!</h3>
          <form action="//formspree.io/david@tinavg.com" method="POST" target="_blank" class="vertical layout">
              <paper-input name="_replyto" type="email" label="your email"></paper-input>
              <paper-textarea name="message" label="your message"></paper-textarea>
              <input type="text" name="_gotcha" style="display:none" />
              <input type="submit" value="Send" />
          </form>
        </div>
      </iron-pages>
      <div class="horizontal end-justified flex layout">
        <paper-button raised><a href="/privacy.html" target="_blank">Privacy Policy</a></paper-button>
        <paper-button raised dialog-dismiss autofocus>Close</paper-button>
      </div>
    </paper-dialog>
  </template>
</dom-module>
<script>
  Polymer({
    is: 'tinavg-webapp',
    behaviors: [TinavgBehavior],
    properties: {
      languageList: {
        type: Array,
        value: function() {
          return [
            {"abbrev": "de","fullname": "German"}, 
            {"abbrev": "en", "fullname":"English"}, 
            {"abbrev": "en-US-south", "fullname": "English (US South)"}, 
            {"abbrev": "ar","fullname": "Arabic"},
            {"abbrev":"ko","fullname": "Korean"}, 
            {"abbrev":"ru","fullname":"Russian"}, 
            {"abbrev":"he", "fullname": "Hebrew"}
            ];
        }
      },
      letterLimit: {
        type: Number,
        value: 12
      },
      learnmodus: {
        type: Boolean
      },
      recordmodus: {
        type: Boolean
      },
      nerdmodus: {
        type: Boolean
      },
      earmodus: {
        type: Boolean
      },
      nerdSprache: {
        type: String
      },
      nerdSpracheList: {
        type: Array,
        value: function() { 
          return [
            {"abbrev": "de","fullname": "German"}, 
            {"abbrev": "en", "fullname":"English"}, 
            {"abbrev": "ar","fullname": "Arabic"},
            {"abbrev":"ko","fullname": "Korean"}, 
            {"abbrev":"ru","fullname":"Russian"}, 
            {"abbrev":"he", "fullname": "Hebrew"}, 
            {"abbrev": "tr", "fullname": "Turkish"}
            ]; 
        }
      },
      user: {
        type: Object,
        notify: true
      }
    },
    listeners: {
      'letter-card-tapped': 'letterTapped',
      'stripdia-set': 'setWBoardDisplay',
      'ready-set-go': 'lettersSet',
      'checking-word': 'fbLetterSeq'
    },
    observers: [

    ],
    created: function() {

      if(localStorage.getItem("tinavg-earmodus") === undefined) {
        this.earmodus = JSON.parse(localStorage.getItem("tinavg-earmodus"));
      }

      if(localStorage.getItem("tinavg-learnmodus") === undefined) {
        this.learnmodus = JSON.parse(localStorage.getItem("tinavg-learnmodus"));
      }

      if(localStorage.getItem("tinavg-recordmodus") === undefined) {
        this.recordmodus = JSON.parse(localStorage.getItem("tinavg-recordmodus"));
      }

      if(JSON.parse(localStorage.getItem("tinavg-nerdmodus")) === undefined) {
        this.nerdmodus = JSON.parse(localStorage.getItem("tinavg-nerdmodus"));
      }

      if(JSON.parse(localStorage.getItem("tinavg-nerdsprache")) === undefined) {
        this.nerdSprache = JSON.parse(localStorage.getItem("tinavg-nerdsprache"));
      }
    },
    ready: function() {

      // localStorage functions and setting defaults
      window.localStorage["tinavg-lastvisit"] = new Date();
      if(_findWithAttr(this.languageList, "abbrev", JSON.parse(localStorage.getItem("tinavg-lastlang"))) === -1) {
        this.gameLang = "de";
      } else {
        this.gameLang = JSON.parse(localStorage.getItem("tinavg-lastlang"));
      }
      if(this.earmodus === undefined) this.earmodus = false;
      if(this.learnmodus === undefined) this.learnmodus = false;
      if(this.recordmodus === undefined) this.recordmodus = false;
      if(this.nerdmodus === undefined) this.nerdmodus = false;
      if(this.nerdSprache === undefined) this.nerdSprache = "de";
      this.$.jt.forceLearnmodus(this.learnmodus);
      
      // selected tab
      if(!this.selected) this.selected = 0;
      
      // firebase
      var fbRef = new Firebase('https://intense-heat-8981.firebaseio.com');
      var lastlogin = window.localStorage["tinavg-lastvisit"];
      this.letterSeq = [];
      fbRef.onAuth(function(authData) {
        if (authData) {
          // save the user's profile into Firebase so we can list users,
          // use them in Security and Firebase Rules, and show profiles
          fbRef.child("users").child(authData.uid).update({
            provider: authData.provider,
            name: _getFirebaseName(authData),
            lastlogin: lastlogin,
            stimestamp: Firebase.ServerValue.TIMESTAMP,
            options: this.getOptions()
          });
          fbRef.child("users").child(authData.uid).child("logins").push({
            lastlogin: lastlogin,
            stimestamp: Firebase.ServerValue.TIMESTAMP
          });
        } else {
          fbRef.child("users").child("anonymous").child("logins").push({
            lastlogin: lastlogin,
            stimestamp: Firebase.ServerValue.TIMESTAMP
          });
        }
      }.bind(this));
      
      this.firebaseRef = fbRef;

      // Keyboard Shortcut Bindings
      Mousetrap.bind('shift+enter', function() { 
        this.$.jt.click(); 
      }.bind(this));
      Mousetrap.bind('enter', function() {
        document.activeElement.click();
        if(typeof document.activeElement.firePaperRipple === 'function') document.activeElement.firePaperRipple(false);
      });
      Mousetrap.bind('shift+p', function() {
        this.$.wboard.tapWord(false);
      }.bind(this));
      Mousetrap.bind('shift+l', function() {
        this.$.switchModusIcon.click();
      }.bind(this));
      Mousetrap.bind('left', function() {
        var lastTab = this.lastTabIndex;
        this.lastTabIndex = document.activeElement.tabIndex;
        var prevIndex = (document.activeElement.tabIndex === -1) ? this.letterLimit : (document.activeElement.tabIndex - 1 > 0) ? document.activeElement.tabIndex - 1 : this.letterLimit;
        document.querySelector('[tabindex="'+ (prevIndex) + '"]').focus();
      }.bind(this));
      Mousetrap.bind('right', function() {
        var lastTab = this.lastTabIndex;
        this.lastTabIndex = document.activeElement.tabIndex;
        var nextIndex = (document.activeElement.tabIndex === -1 || document.activeElement.tabIndex + 1 > this.letterLimit) ? 1 : document.activeElement.tabIndex + 1;
        document.querySelector('[tabindex="'+ (nextIndex) + '"]').focus();
      }.bind(this));
      Mousetrap.bind('up', function() {
        var lastTab = this.lastTabIndex;
        this.lastTabIndex = document.activeElement.tabIndex;
        var moveFocus = (window.innerHeight > window.innerWidth) ? 3 : 4;
        var prevIndex = (document.activeElement.tabIndex === -1) ? 1 : (document.activeElement.tabIndex - moveFocus > 0) ? document.activeElement.tabIndex - moveFocus : this.jumbotronIndexCompute();
        document.querySelector('[tabindex="'+ (prevIndex) + '"]').focus();
      }.bind(this));
      Mousetrap.bind('down', function() {
        var lastTab = this.lastTabIndex;
        this.lastTabIndex = document.activeElement.tabIndex;
        var moveFocus = (window.innerHeight > window.innerWidth) ? 3 : 4;
        var newFocus = (document.activeElement.tabIndex + moveFocus < this.jumbotronIndexCompute()) ? document.activeElement.tabIndex + moveFocus : (document.activeElement.tabIndex === this.jumbotronIndexCompute()) ? lastTab : document.activeElement.tabIndex;
        var downIndex = (document.activeElement.tabIndex === -1) ? 1 : newFocus;
        document.querySelector('[tabindex="'+ (downIndex) + '"]').focus();
      }.bind(this));
      Mousetrap.bind('backspace', function(e) {
        // stub to play a wawa sound
        if (e.preventDefault) {
          e.preventDefault();
        } else {
          // internet explorer
          e.returnValue = false;
        }
        console.log("backspace...");
      });
      
      // remove unresolve, reveal app, show help
      document.getElementById('friendly_message').setAttribute('hidden', true);
      document.querySelector('[unresolved]').removeAttribute("unresolved");
      this.showHelp();
      
      //preload flags
      for(var i = 0; i < this.languageList.length; i++) {
        new Image().src = "/assets/images/" + this.languageList[i].abbrev + ".png";
      }

      this.async(function() { 
        this.$.meiselspracheliste.selectedIndex = _findWithAttr(this.nerdSpracheList, "abbrev", this.nerdSprache); 
        this.$.selectLang.selectedIndex = _findWithAttr(this.languageList, "abbrev", this.gameLang);
      }, 100);

    },
    setLangHelp: function() {
      var langHtml = this.$.lettergrid.getLangHelpInfo();
      if(langHtml) {
        document.getElementById("help-lang-specific").innerHTML = langHtml;
      } else {
        document.getElementById("help-lang-specific").innerHTML = "";
      }
    },
    letterTapped: function(e) {
      this.$.jt.lastBucket = e.detail.letter;
      this.fbLetterSeq(e);
    },
    fbLetterSeq: function(e) {
      if(this.letterSeq.length === 0 && e.detail.letter === '!!!') {
        // do nothing
      } else {
        this.letterSeq.push(e.detail.letter);
      }
      var authData = this.firebaseRef.getAuth();
      if(authData) {
        this.firebaseWordRef.child('letters').set(this.letterSeq);
      } else {
        // not logged in
      }
    },
    showHelp: function(e) {
      this.async(function(){ this.$.so.open();}, 200);
    },
    showClue: function(e) {
      this.$.wboard.revealWord();
      if(this.$.clueshow.classList.contains("glow-yellow")) this.$.clueshow.classList.remove("glow-yellow");
      if(this.$.clueshow.style.transform === "rotateX(360deg)") {
        this.$.clueshow.style.transform = "rotateX(0deg)";
      } else {
        this.$.clueshow.style.transform = "rotateX(360deg)";
      }
    },
    toggleEarModus: function() {
      this.earmodus = !this.earmodus;
    },
    toggleLearnModus: function() {
      this.learnmodus = !this.learnmodus;
      this.$.jt.resetBox();
    },
    toggleRecordModus: function() {
      this.recordmodus = !this.recordmodus;
      this.learnmodus = this.recordmodus;
      this.$.select_learnmodus.toggleAttribute('disabled');
      this.$.jt.resetBox();
    },
    setLang: function(ev) {
      console.log("toggling language: " + ev.target.value + " | chars: " + this.letterLimit);
      this.gameLang = ev.target.value;
      this.$.jt.resetBox();
    },
    setLangManual: function(lang) {
      console.log("toggling language: " + lang + " | chars: " + this.letterLimit);
      this.gameLang = lang;
      this.$.jt.resetBox();
    },
    setWBoardDisplay: function() {
      this.$.wboard.setDisplayWord();
    },
    switchModus: function() {
      var currentLangIndex = _findWithAttr(this.languageList, "abbrev", this.gameLang);
      if(currentLangIndex + 1 < this.languageList.length) {
        this.gameLang = this.languageList[currentLangIndex + 1].abbrev;
      } else {
        this.gameLang = this.languageList[0].abbrev;
      }
      this.$.selectLang.selectedIndex = _findWithAttr(this.languageList, "abbrev", this.gameLang);
      this.$.jt.resetBox();
    },
    toggleNerdModus: function() {
      this.nerdmodus = !this.nerdmodus;
      this.showÜbersetzung();
    },
    showÜbersetzung: function() {
      // stub to add phrase info
      if(this.nerdmodus) {
        if(this.$.wboard.getWordObj().übersetzung !== undefined && this.$.wboard.getWordObj().übersetzung[this.nerdSprache]) {
          this.$.übersetzung.text = this.$.wboard.getWordObj().übersetzung[this.nerdSprache];
        } else if(this.$.wboard.getWordObj().uebersetzungen[this.nerdSprache] !== undefined) {
          this.$.übersetzung.text = this.$.wboard.getWordObj().uebersetzungen[this.nerdSprache];
        } else {
          this.$.übersetzung.text = "Es tut mir Leid.  Keine Übersetzung :-(";
        }
        this.$.übersetzung.show();
      }
    },
    lettersSet: function() {
      this.showÜbersetzung();
      this.letterSeq = [];
      var authData = this.firebaseRef.getAuth();
      if(authData) {
        var wordObj = this.$.wboard.getWordObj();
        var word = { "word": wordObj.word, "ohne": wordObj.ohne } ;
        this.firebaseWordRef = this.firebaseRef.child("users").child(authData.uid).child('words').push(word);
        this.firebaseWordRef.child('timestamp').set(Firebase.ServerValue.TIMESTAMP);
      } else {
        // not logged in
      }
      this.setLangHelp();
    },
    setNerdSprache: function(ev) {
      this.nerdSprache = ev.target.value;
      this.showÜbersetzung();
    },
    login: function() {
      var params;
      try {
        params = JSON.parse(this.params);
      } catch (e) {
        params = null;
      }
      if (this.provider == 'password') {
        params = params || {};
        params.email = this.email;
        params.password = this.password;
      }
      this.$.firebaseLogin.login(params);
    },
    logout: function() {
      this.$.firebaseLogin.logout();
    },
    computeLoginHidden: function(statusKnown, user) {
      return !statusKnown || !!user;
    },
    getOptions: function() {
      var options = {};
      options.language = this.gameLang;
      options.learnmodus = this.learnmodus;
      options.recordmodus = this.recordmodus;
      options.nerdmodus = this.nerdmodus;
      options.nerdsprache = this.nerdSprache;
      options.earmodus = this.earmodus;
      return options;
    },
    jumbotronIndexCompute: function() {
      if(this.letterLimit) {
        return this.letterLimit + 1;
      } else {
        return 12 + 1;        
      }
    }
  });
function _getFirebaseName(authData) {
  switch(authData.provider) {
     case 'password':
       return authData.password.email.replace(/@.*/, '');
     case 'twitter':
       return authData.twitter.displayName;
     case 'facebook':
       return authData.facebook.displayName;
  }
}
function _findWithAttr(array, attr, value) {
    for(var i = 0; i < array.length; i += 1) {
        if(array[i][attr] === value) {
            return i;
        }
    }
    return -1;
}

</script>